<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Generation Financial Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            margin: 20px 0;
        }
        .chart-container {
            position: relative;
            height: 400px;
        }
        .highlight-green {
            color: green;
        }
        .highlight-red {
            color: red;
        }
        .highlight-black {
            color: black;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Power Generation Financial Dashboard</h1>
        <p class="text-center text-muted">Analyze and visualize key financial metrics for your project</p>

        <!-- Data Sources -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Data Sources</h5>
                <ul>
                    <li><b>Electricity Prices:</b> Hourly prices in <code>d24.csv</code> (365 rows × 24 columns).</li>
                    <li><b>Engines:</b>
                        <ul>
                            <li><b>Wärtsilä W16V25SG:</b> Power: 3000 kWe, NG Consumption: 777 m³, Price: $6,000,000</li>
                            <li><b>DHA:</b> Power: 315 kWe, NG Consumption: 84 m³, Price: $2,000,000</li>
                            <li><b>Jenbacher 612:</b> Power: 2200 kWe, NG Consumption: 444.30 m³, Price: $5,000,000</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <!-- User Input Section -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">User Input</h5>
                <form id="userInputForm">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="engineType" class="form-label">Engine Type</label>
                            <select id="engineType" class="form-select" onchange="updateEngineDetails()">
                                <option value="DHA">DHA</option>
                                <option value="Wartsila">Wärtsilä W16V25SG</option>
                                <option value="Jenbacher">Jenbacher 612</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="numberOfEngines" class="form-label">Number of Engines</label>
                            <input type="number" id="numberOfEngines" class="form-control" value="1">
                        </div>
                        <div class="col-md-4">
                            <label for="loadPercentage" class="form-label">Load %</label>
                            <input type="number" id="loadPercentage" class="form-control" value="90">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <label for="gasPrice" class="form-label">Gas Price per m³ ($)</label>
                            <input type="number" id="gasPrice" class="form-control" value="16.5">
                        </div>
                        <div class="col-md-4">
                            <label for="enginePrice" class="form-label">Engine Price ($)</label>
                            <input type="text" id="enginePrice" class="form-control" readonly>
                        </div>
                        <div class="col-md-4">
                            <label for="ngConsumption" class="form-label">NG Consumption (m³)</label>
                            <input type="text" id="ngConsumption" class="form-control" readonly>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Monthly Costs Section -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Monthly Costs</h5>
                <form id="monthlyCostsForm">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="oilCost" class="form-label">Oil Cost ($)</label>
                            <input type="number" id="oilCost" class="form-control" value="32800">
                        </div>
                        <div class="col-md-4">
                            <label for="serviceCost" class="form-label">Service and Parts ($)</label>
                            <input type="number" id="serviceCost" class="form-control" value="41000">
                        </div>
                        <div class="col-md-4">
                            <label for="workerCost" class="form-label">Worker Salaries ($)</label>
                            <input type="number" id="workerCost" class="form-control" value="49200">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <label for="salaryTaxes" class="form-label">Salary Taxes (22%) ($)</label>
                            <input type="number" id="salaryTaxes" class="form-control" value="10824">
                        </div>
                        <div class="col-md-4">
                            <label for="otherExpenses" class="form-label">Other Expenses ($)</label>
                            <input type="number" id="otherExpenses" class="form-control" value="61500">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Calculations & Results Section -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Calculations & Results</h5>
                <div id="results" class="mt-3">
                    <p><b>Generation kWe:</b> <span id="generationKWe">0</span></p>
                    <p><b>Consumption m³:</b> <span id="consumptionM3">0</span></p>
                    <p><b>Investment +20%:</b> <span id="investment20">0</span></p>
                    <p><b>1 kWe Price:</b> <span id="pricePerKWe">0</span></p>
                    <p><b>1 MWe Price:</b> <span id="pricePerMWe">0</span></p>
                </div>
            </div>
        </div>

        <!-- Monthly Summary Table -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Monthly Summary</h5>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>kWe Sold</th>
                            <th>Gas Cost</th>
                            <th>Gas VAT</th>
                            <th>Electricity VAT</th>
                            <th>Net VAT</th>
                            <th>Income</th>
                            <th>Revenue</th>
                            <th>Break-even</th>
                        </tr>
                    </thead>
                    <tbody id="monthlySummary">
                        <!-- Rows populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Visualization Section -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Price Table</h5>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Hour 1</th>
                            <th>Hour 2</th>
                            <th>...</th>
                            <th>Hour 24</th>
                        </tr>
                    </thead>
                    <tbody id="priceTable">
                        <!-- Rows populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            const engineData = {
                "DHA": { power: 315, consumption: 84, price: 2000000 },
                "Wartsila": { power: 3000, consumption: 777, price: 6000000 },
                "Jenbacher": { power: 2200, consumption: 444.3, price: 5000000 }
            };

            function updateEngineDetails() {
                const engineType = document.getElementById('engineType').value;
                const engine = engineData[engineType];

                document.getElementById('enginePrice').value = engine.price;
                document.getElementById('ngConsumption').value = engine.consumption;
            }

            function calculateMetrics() {
                const numberOfEngines = parseInt(document.getElementById('numberOfEngines').value);
                const load = parseFloat(document.getElementById('loadPercentage').value) / 100;
                const gasPrice = parseFloat(document.getElementById('gasPrice').value);
		parseFloat(document.getElementById('gasPrice').value);
                const engineType = document.getElementById('engineType').value;
                const engine = engineData[engineType];

                const generationKWe = engine.power * load * numberOfEngines;
                const consumptionM3 = engine.consumption * load * numberOfEngines;
                const investment20 = engine.price * numberOfEngines * 1.2;
                const pricePerKWe = (engine.consumption * gasPrice) / engine.power;
                const pricePerMWe = pricePerKWe * 1000;

                document.getElementById('generationKWe').textContent = generationKWe.toFixed(2);
                document.getElementById('consumptionM3').textContent = consumptionM3.toFixed(2);
                document.getElementById('investment20').textContent = `$${investment20.toFixed(2)}`;
                document.getElementById('pricePerKWe').textContent = `$${pricePerKWe.toFixed(2)}`;
                document.getElementById('pricePerMWe').textContent = `$${pricePerMWe.toFixed(2)}`;
            }

            function loadPriceTable() {
                fetch('./d24.csv')
                    .then(response => response.text())
                    .then(data => {
                        const rows = data.split('\n');
                        const tableBody = document.getElementById('priceTable');
                        rows.forEach((row, index) => {
                            const cols = row.split(',');
                            const tableRow = document.createElement('tr');
                            const dayCell = document.createElement('td');
                            dayCell.textContent = `Day ${index + 1}`;
                            tableRow.appendChild(dayCell);
                            cols.forEach(col => {
                                const cell = document.createElement('td');
                                cell.textContent = col;
                                tableRow.appendChild(cell);
                            });
                            tableBody.appendChild(tableRow);
                        });
                    });
            }

            function initializeDashboard() {
                updateEngineDetails();
                calculateMetrics();
                loadPriceTable();
            }

            window.onload = initializeDashboard;
        </script>
    </div>
</body>
</html>
